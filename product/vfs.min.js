function FileObject(e){e="undefined"!=typeof e?e:{},this.uniqueId="undefined"!=typeof e.uniqueId?e.uniqueId:0,this.directoryId="undefined"!=typeof e.directoryId?e.directoryId:0,this.name="undefined"!=typeof e.name?e.name:"",this.type="undefined"!=typeof e.type?e.type:"plain/text",this.created_at="undefined"!=typeof e.created_at?e.created_at:new Date,this.updated_at="undefined"!=typeof e.updated_at?e.updated_at:new Date,this.executed_at="undefined"!=typeof e.executed_at?e.executed_at:new Date,this.content="undefined"!=typeof e.content?e.content:"",this.readOnly="undefined"!=typeof e.readOnly?e.readOnly:!1}function FileSystem(e){function t(){return y.setData("file-counter",c+1),c++}function n(e){e="object"==typeof e?e:{};var t="undefined"!=typeof e.content?e.content:"";delete e.content;var n=new FileObject(e);return delete n.content,y.setData("file-"+e.uniqueId,n.serialize()),"directory"===e.type?p.create(e.uniqueId):y.setData("file-content-"+e.uniqueId,t),p.set(e.uniqueId,e.directoryId)&&p.save(),n}function i(e){e="object"==typeof e?e:{};var t=e.uniqueId,n=y.getData("file-"+t),i=y.getData("file-content-"+t);if(!n)return console.error("FileSystem API: Failed to update file. File does not exists."),!1;n=JSON.parse(n);var r=n.readOnly;if(r&&"undefined"!=typeof e.content&&e.content!==i)return console.error("FileSystem API: File is read only."),!1;n.content=y.getData("file-content-"+t);var o=!1;for(var a in n)if("uniqueId"!==a&&"size"!==a&&"serialize"!==a&&("directory"!==n.type||"content"!==a)&&"undefined"!=typeof e[a]){if("directoryId"===a&&n.directoryId!==e.directoryId){var d=n.directoryId,s=e.directoryId;if(!p.unset(d,e.uniqueId)){o=!0;break}if(!p.set(e.uniqueId,s)){o=!0;break}}n[a]=e[a]}return o?(p.restore(),!1):(p.save(),"directory"!==n.type&&y.setData("file-content-"+t,n.content),delete n.content,n.updated_at=(new Date).toGMTString(),y.setData("file-"+t,n.serialize()),!0)}function r(){return y.setData("installed",(new Date).toGMTString()),y.setData("file-pointers",{0:[],1:[]}.serialize()),p.init(),n({uniqueId:0,name:"FileSystemEntry",created_at:new Date,updated_at:new Date,executed_at:new Date,directoryId:0,type:"directory"}),n({uniqueId:1,name:"Root",created_at:new Date,updated_at:new Date,executed_at:new Date,directoryId:0,type:"directory"}),n({uniqueId:2,name:"System",created_at:new Date,updated_at:new Date,executed_at:new Date,directoryId:1,type:"directory"}),n({uniqueId:3,name:"UserData",created_at:new Date,updated_at:new Date,executed_at:new Date,directoryId:1,type:"directory"}),n({uniqueId:4,name:"RecycleBin",created_at:new Date,updated_at:new Date,executed_at:new Date,directoryId:1,type:"directory"}),c=5,y.setData("file-counter",5),console.log("FileSystem API: Installed: "+(new Date).toGMTString()+", Key: "+u),!0}function o(){console.log("FileSystem API: Format FS:"+u);var e=new RegExp(u);for(var t in localStorage)e.test(t)&&localStorage.removeItem(t);return r(),!0}function a(){var e=y.getData("installed");"undefined"==typeof e?r():(c=parseInt(y.getData("file-counter")),f=JSON.parse(y.getData("file-pointers")),p.init(),console.log("FileSystem loaded: "+u))}e="undefined"!=typeof e?e:{};var d=1,s="vjfs1",u="undefined"!=typeof e.key?Crypto.hash(e.key):!1,l="undefined"!=typeof e.readOnly?e.readOnly:!1;if(!u)return console.error("FileSystem API: Failed to create FileSystem object. No key."),!1;var c=0,f={};this.getVersion=function(){return d},this.getEngine=function(){return s},this.getKey=function(){return u};var y={getData:function(e){return localStorage[u+"_"+e]},setData:function(e,t){localStorage[u+"_"+e]=t},removeData:function(e){localStorage.removeItem(u+"_"+e)}},p=new function(){var e=[],t=!1;this.init=function(){return e=JSON.parse(y.getData("file-pointers")),t=!0,!0},this.save=function(){return t?(f=e,y.setData("file-pointers",f.serialize()),f=e,!0):(console.error("FilePointer API: Pointers are not initialized."),!1)},this.restore=function(){return t?(e=f,!0):(console.error("FilePointer API: Pointers are not initialized."),!1)},this.create=function(n){return t?(e[n]=[],!0):(console.error("FilePointer API: Pointers are not initialized."),!1)},this["delete"]=function(n){return t?(delete e[n],!0):(console.error("FilePointer API: Pointers are not initialized."),!1)},this.set=function(n,i){return t?"undefined"==typeof e[i]?(console.error("FileSystem API: Pointed File does not exists."),!1):(e[i].push(n),!0):(console.error("FilePointer API: Pointers are not initialized."),!1)},this.get=function(n){return t?"undefined"==typeof n?e:e[n]:(console.error("FilePointer API: Pointers are not initialized."),!1)},this.unset=function(n,i,r){if(!t)return console.error("FilePointer API: Pointers are not initialized."),!1;r="undefined"==typeof r?!0:!!r;var o=e[n];if("undefined"==typeof o)return r?(console.error("FileSystem API: Pointed File does not exists."),!1):(console.log("FileSystem API: [Unstrict passed] Pointed File was not existed, but passed."),!0);for(var a=!1,d=0,s=o.length;s>d;d++)if(o[d]===i){a=!0,o.splice(d,1),e[n]=o;break}return a?!0:(console.error("FileSystem API: Releasing non exists file."),!1)}};this.createFile=function(e){if(l)return console.error("FileSystem API: FileSystem is read-only."),!1;if(e="object"==typeof e?e:{},e.uniqueId=t(),"undefined"==typeof e.directoryId)return console.error("FileSystem API: Failed to create file. No Parent directory."),!1;if("undefined"==typeof e.name)return console.error("FileSystem API: Failed to create file. File has no name."),!1;if(0===e.directoryId||1===e.directoryId||2===e.directoryId||4===e.directoryId)return console.error("FileSystem API: Failed to create file. Access denied."),!1;var i=!1;for(var r in f)if(parseInt(r)===e.directoryId){i=!0;break}if(!i)return console.error("FileSystem API: Failed to create file. Directory does not exists."),!1;for(var o=!1,a=p.get(e.directoryId),r=0,d=a.length;d>r;r++){var s=y.getData("file-"+a[r]);if(s=JSON.parse(s),s.name===e.name){o=!0;break}}return o?(console.error("FileSystem API: Failed to create file. Duplicated File name "+e.name+"."),!1):n(e)},this.updateFile=function(e){if(l)return console.error("FileSystem API: FileSystem is read-only."),!1;if(e="object"==typeof e?e:{},"undefined"==typeof e.uniqueId)return console.error("FileSystem API: Failed to update file. uniqueId must be required."),!1;if(0===e.uniqueId||1===e.uniqueId||2===e.uniqueId||4===e.uniqueId)return console.error("FileSystem API: Failed to update file. Access denied."),!1;if("undefined"!=typeof e.directoryId){if(0===e.directoryId||1===e.directoryId||2===e.directoryId||4===e.directoryId)return console.error("FileSystem API: Failed to update file. Access denied."),!1;var t=!1;for(var n in f)if(parseInt(n)===e.directoryId){t=!0;break}if(!t)return console.error("FileSystem API: Failed to update file. Destination directory does not exists."),!1}if("undefined"==typeof y.getData("file-"+e.uniqueId))return console.error("FileSystem API: File does not exists."),!1;var r=JSON.parse(y.getData("file-"+e.uniqueId));"undefined"==typeof e.directoryId&&(e.directoryId=r.directoryId),"undefined"==typeof e.name&&(e.name=r.name);for(var o=!1,a=p.get(e.directoryId),n=0,d=a.length;d>n;n++){var s=y.getData("file-"+a[n]);if(s=JSON.parse(s),s.uniqueId!==e.uniqueId&&s.name===e.name){o=!0;break}}return o?(console.error("FileSystem API: Failed to update file. Duplicated File name "+e.name+"."),!1):i(e)},this.removeFile=function(e){return l?(console.error("FileSystem API: FileSystem is read-only."),!1):(e="object"==typeof e?e:{},"undefined"==typeof e.uniqueId?(console.error("FileSystem API: Failed to update file. uniqueId must be required."),!1):0===e.uniqueId||1===e.uniqueId||2===e.uniqueId||3===e.uniqueId||4===e.uniqueId?(console.error("FileSystem API: Failed to delete file. Access denied."),!1):(console.error("FileSystem API: File does not exists."),!1))},this.getFileById=function(e){var t=y.getData("file-"+e);return"undefined"==typeof t?(console.error("FileSystem API: Failed to get file. File does not exists."),!1):(t=JSON.parse(t),"directory"!==t.type&&(t.content=y.getData("file-content-"+e)),t)},this.scan=function(e){var t=p.get(e);return"undefined"==typeof t?(console.error("FileSystem API: Failed to scan. Directory does not exists."),!1):t},this.serialize=function(){var e=new RegExp(u),t={};t.backupDate=(new Date).toGMTString(),t.systemKey=u,t.version=d,t.engine=s;for(var n in localStorage)if("serialize"!==n&&"size"!==n&&e.test(n)){var i=localStorage[n],r=n.replace(u+"_","");t[r]=i}return t.serialize()},this["import"]=function(e){var t={};try{t=JSON.parse(e)}catch(n){t=!1,console.error("FileSystem API: Failed to import FileSystem. Unknown FileSystem.")}if(!t)return!1;if("undefined"==typeof t.backupDate||"undefined"==typeof t.systemKey||"undefined"==typeof t.version||"undefined"==typeof t.engine)return console.error("FileSystem API: Failed to import FileSystem. Unknown FileSystem."),!1;if(console.log("FileSystem: Load FileSystem..."),t.engine!==s)return console.error("FileSystem API: Failed to import FileSystem. Unsupported FileSystem Engine "+t.engine+"."),!1;d=t.version,s=t.engine,console.log("FileSystem Imported."),console.log("Backup Date: "+t.backupDate),console.log("Storage Key: "+t.systemKey),console.log("Version: "+t.version),console.log("Engine: "+t.engine),o();for(var i in t)"size"!==i&&"serialize"!==i&&"backupDate"!==i&&"systemKey"!==i&&"version"!==i&&"engine"!==i&&y.setData(u+"_"+i,t[i]);return!0},this.format=function(){return o()},a()}Object.prototype.serialize=function(){return JSON.stringify(this)},Object.prototype.size=function(){var e,t=0;for(e in this)"size"!==e&&"serialize"!==e&&this.hasOwnProperty(e)&&t++;return t},"undefined"==typeof String.prototype.utf8Encode&&(String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))}),"undefined"==typeof String.prototype.utf8Decode&&(String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this))}catch(e){return this}}),window.Crypto=new function(){this.hash=function(e){e=e.toString(),e=e.utf8Encode();var t=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],n=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];e+=String.fromCharCode(128);for(var i=e.length/4+2,r=Math.ceil(i/16),o=new Array(r),a=0;r>a;a++){o[a]=new Array(16);for(var d=0;16>d;d++)o[a][d]=e.charCodeAt(64*a+4*d)<<24|e.charCodeAt(64*a+4*d+1)<<16|e.charCodeAt(64*a+4*d+2)<<8|e.charCodeAt(64*a+4*d+3)}o[r-1][14]=8*(e.length-1)/Math.pow(2,32),o[r-1][14]=Math.floor(o[r-1][14]),o[r-1][15]=8*(e.length-1)&4294967295;for(var s,u,l,c,f,y,p,I,h=new Array(64),a=0;r>a;a++){for(var F=0;16>F;F++)h[F]=o[a][F];for(var F=16;64>F;F++)h[F]=this.σ1(h[F-2])+h[F-7]+this.σ0(h[F-15])+h[F-16]&4294967295;s=n[0],u=n[1],l=n[2],c=n[3],f=n[4],y=n[5],p=n[6],I=n[7];for(var F=0;64>F;F++){var m=I+this.Σ1(f)+this.Ch(f,y,p)+t[F]+h[F],S=this.Σ0(s)+this.Maj(s,u,l);I=p,p=y,y=f,f=c+m&4294967295,c=l,l=u,u=s,s=m+S&4294967295}n[0]=n[0]+s&4294967295,n[1]=n[1]+u&4294967295,n[2]=n[2]+l&4294967295,n[3]=n[3]+c&4294967295,n[4]=n[4]+f&4294967295,n[5]=n[5]+y&4294967295,n[6]=n[6]+p&4294967295,n[7]=n[7]+I&4294967295}return this.toHexStr(n[0])+this.toHexStr(n[1])+this.toHexStr(n[2])+this.toHexStr(n[3])+this.toHexStr(n[4])+this.toHexStr(n[5])+this.toHexStr(n[6])+this.toHexStr(n[7])},this.ROTR=function(e,t){return t>>>e|t<<32-e},this.Σ0=function(e){return this.ROTR(2,e)^this.ROTR(13,e)^this.ROTR(22,e)},this.Σ1=function(e){return this.ROTR(6,e)^this.ROTR(11,e)^this.ROTR(25,e)},this.σ0=function(e){return this.ROTR(7,e)^this.ROTR(18,e)^e>>>3},this.σ1=function(e){return this.ROTR(17,e)^this.ROTR(19,e)^e>>>10},this.Ch=function(e,t,n){return e&t^~e&n},this.Maj=function(e,t,n){return e&t^e&n^t&n},this.toHexStr=function(e){for(var t,n="",i=7;i>=0;i--)t=e>>>4*i&15,n+=t.toString(16);return n}};